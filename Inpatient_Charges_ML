# Tristan Kaiser
# InpatientCharges ML Practice
# 10/27/2016

install.packages("RColorBrewer")

library(dplyr)
library(magrittr)
library(rpart)
library(rattle)
library(rpart.plot)
library(RColorBrewer)

df <- read.csv("C:/Users/Tristan/Desktop/RFiles/inpatientCharges.csv")

names(df) %<>% tolower
names(df) <- gsub(" ", ".", names(df), fixed = TRUE)

df$average.total.payments <- as.numeric(gsub("[$]", "", df$average.total.payments))
df$average.covered.charges <- as.numeric(gsub("[$]", "", df$average.covered.charges))
df$average.medicare.payments <- as.numeric(gsub("[$]", "", df$average.medicare.payments))
head(df)

data <- df %>%
  select(provider.state, average.total.payments, average.medicare.payments, total.discharges)

set.seed(1)

# Shuffle the dataset, call the result shuffled
n <- nrow(data)
shuffled <- data[sample(n),]

# Split the data in train and test

# Modify (0.1 * n) to select % of dataset to test
train_indices <- 1:round(0.1 * n)
train <- shuffled[train_indices, ]
trainingData <- data[train,]

# Run ML
tree <- rpart(total.discharges ~ ., train, method = "class", control = rpart.control(cp=0.01))
fancyRpartPlot(tree)


testData <- data[-train,]
test_indices <- (round(0.3 * n) + 1):n
test <- shuffled[test_indices, ]
